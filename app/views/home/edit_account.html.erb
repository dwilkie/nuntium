<h4>Edit settings / Change password</h4>

<% form_for :account, :url => { :controller => 'home', :action => :update_account } do |f| %>
  <%= f.error_messages %>
  <p>
  <%= f.label :max_tries %><br/>
  <%= f.text_field :max_tries %>
  </p>
  <hr />
  <p>
  <b>Leave blank if you don't want to change the password</b><br/>
  <%= f.label :password %><br/>
  <%= f.password_field :password, :value => '', :autocomplete => :off %>
  </p>
  <p>
  <%= f.label :password_confirmation %><br/>
  <%= f.password_field :password_confirmation, :value => '', :autocomplete => :off %>
  </p>
  
  <h5>Application Routing Rules</h5>
  
  <%
  applications = @account.applications.map(&:name).sort!
  if applications.length < 2
    %>
    <p>
    No need to specify these rules right now since you do not have more than one application.
    </p>
    <%
  else
    %>
    <p>
    Specify here rules to route AT messages to specific applications.<br/>
    These rules will not be executed if an AT message is received via a channel that belongs to an application<br/>
    or when a message specifies the custom attribute "application".
    <a href="http://code.google.com/p/nuntium/wiki/Rules" target="_blank">Learn more...</a>
    </p>
    
    <p>
    <b>Here you can only determine the target application. To change an AT message's attributes specify
    AT rules for each application.</b>
    </p>
    
    <div class="apprules"></div>

    <script type="text/javascript">
    var applications = <%= applications.to_json %>;	
    jQuery(function(){
	    init_rules(jQuery('.apprules'), 'apprules', <%= @account.app_routing_rules.to_json %>, null, ['application']);
    });
    </script>
  <%
  end
  %>
  <%= submit_tag 'Update' %>
<% end %>

<%= go_back_link %>
