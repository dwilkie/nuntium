<h3>Current application is: <%= @application.name %> (<%= link_to "logoff", :controller => :home, :action => :logoff %>)</h3>

<% if !flash[:notice].nil? %>
<div style="border:1px solid black; background:#FFF1A8; padding:4px; font-weight:bold"><%= flash[:notice] %></div>
<% end %>

<h4>Interactions</h4>

<% if @channels.empty? %>
  To interact with this application you must first <%= link_to "create a new qst channel", :controller => :home, :action => :new_channel %>.
<% else %>
  <div style="padding-left:20px">
  
  <div><b>Via RSS</b></div>
  Use <a href="http://en.wikipedia.org/wiki/Basic_access_authentication" target="_blank">Http Basic Authentication</a> with application credentials.
  
  <ul>
    <li><span style="font-family:monospace">POST <%= url_for :controller => :rss, :action => :create %></span>: 
      create Application Originated Messages</li>
    <li><span style="font-family:monospace">GET <%= url_for :controller => :rss, :action => :index %></span>:
      read Application Terminated Messages</li>
  </ul>
  
  
  <div><b>Via <a href="http://code.google.com/p/geochat/wiki/QueueStateTransfer" target="_blank">QueueStateTransfer</a></b></div>
  Use <a href="http://en.wikipedia.org/wiki/Basic_access_authentication" target="_blank">Http Basic Authentication</a> with channel credentials.
  
  <ul>
    <li><span style="font-family:monospace">GET <%= url_for :controller => :outgoing, :action => :index, :application_id => @application.name %></span>:
      read Application Originated Messages</li>
    <li><span style="font-family:monospace">HEAD <%= url_for :controller => :incoming, :action => :index, :application_id => @application.name %></span>:
      get last Application Terminated Message id</li>
    <li><span style="font-family:monospace">POST <%= url_for :controller => :incoming, :action => :create, :application_id => @application.name %></span>:
      create Application Terminated Messages</li>
  </ul>
  </div>
<% end %>

<h4>Settings</h4>

<ul>
  <li>Max tries: <%= @application.max_tries %></li>
</ul>

<%= link_to "Edit settings / Change password", :controller => :home, :action => :edit_application %>

<h4>Channels</h4>

<% if @channels.empty? %>
  No channels.
<% else %>
  <ul>
    <% @channels.each do |chan| %>
      <li><b><%= chan.name %></b> => protocol: <%= chan.protocol %>, kind: <%= chan.kind %> <%= link_to "edit", :controller => :home, :action => :edit_channel, :id => chan.id %> <a href="javascript:void(0)" onclick="delete_channel(<%= chan.id %>, '<%= h chan.name %>')">delete</a></li>
    <% end %>
  </ul>
<% end %>

<%= link_to "Create new qst channel", :controller => :home, :action => :new_channel %>

<h4>Last Application Originated Messages</h4>

<% if @ao_messages.empty? %>
  No messages.
<% else %>
  <table border="1">
    <tr>
      <th>When</th>
      <th>From</th>
      <th>To</th>
      <th>Subject</th>
      <th>Body</th>
      <th>Tries</th>
      <th>State</th>
    </tr>
    <tr>
    <% @ao_messages.each do |msg| %>
      <tr>
        <td><%= msg.timestamp %></td>
        <td><%= short_html msg.from %></td>
        <td><%= short_html msg.to %></td>
        <td><%= short_html msg.subject %></td>
        <td><%= short_html msg.body %></td>
        <td><%= msg.tries %></td>
        <td><%= msg.state %></td>
      </tr>
    <% end %>
  </table>
<% end %>

<h4>Last Application Terminated Messages</h4>

<% if @at_messages.empty? %>
  No messages.
<% else %>
  <table border="1">
    <tr>
      <th>When</th>
      <th>From</th>
      <th>To</th>
      <th>Subject</th>
      <th>Body</th>
      <th>Tries</th>
      <th>State</th>
    </tr>
    <tr>
    <% @at_messages.each do |msg| %>
      <tr>
        <td><%= msg.timestamp %></td>
        <td><%= short_html msg.from %></td>
        <td><%= short_html msg.to %></td>
        <td><%= short_html msg.subject %></td>
        <td><%= short_html msg.body %></td>
        <td><%= msg.tries %></td>
        <td><%= msg.state %></td>
      </tr>
    <% end %>
  </table>
<% end %>
  
<script>
function delete_channel(id, name) {
  if (confirm('Are you sure you want to delete the channel ' + name + '?')) {
    window.location = '/channel/delete/' + id;
  }
}
</script>